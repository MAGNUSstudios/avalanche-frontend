import React from 'react';
import { styled } from '../stitches.config';
import {
  Users as UsersIcon,
  Search,
  Download,
  Ban,
  Unlock,
  ChevronDown,
  Calendar,
  Receipt,
  TrendingUp,
} from 'lucide-react';
import AdminLayout from '../components/layout/AdminLayout';
import AdminAuthGuard from '../components/auth/AdminAuthGuard';

const PageContainer = styled('div', {
  display: 'flex',
  minHeight: '100vh',
  backgroundColor: 'var(--bg-primary)',
});

const Sidebar = styled('aside', {
  width: '240px',
  backgroundColor: 'var(--card-bg)',
  borderRight: '1px solid var(--border-color)',
  padding: '$6',
  display: 'flex',
  flexDirection: 'column',
  gap: '$6',
});

const Logo = styled('div', {
  display: 'flex',
  alignItems: 'center',
  gap: '$2',
  marginBottom: '$4',
});

const LogoImage = styled('div', {
  width: '32px',
  height: '32px',
  borderRadius: '$full',
  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  color: 'white',
  fontSize: '$sm',
  fontWeight: '$bold',
});

const LogoText = styled('div', {
  display: 'flex',
  flexDirection: 'column',
});

const LogoTitle = styled('span', {
  fontSize: '$lg',
  fontWeight: '$bold',
  color: 'var(--text-primary)',
});

const LogoSubtitle = styled('span', {
  fontSize: '$xs',
  color: 'var(--text-secondary)',
});

const Nav = styled('nav', {
  display: 'flex',
  flexDirection: 'column',
  gap: '$2',
});

const NavItem = styled('a', {
  display: 'flex',
  alignItems: 'center',
  gap: '$3',
  padding: '$3 $4',
  borderRadius: '$base',
  color: 'var(--text-primary)',
  textDecoration: 'none',
  fontSize: '$sm',
  transition: 'all 0.2s ease',
  cursor: 'pointer',

  '&:hover': {
    backgroundColor: 'var(--bg-tertiary)',
  },

  variants: {
    active: {
      true: {
        backgroundColor: 'var(--primary-color)',
        color: 'white',

        '&:hover': {
          backgroundColor: 'var(--primary-hover)',
        },
      },
    },
  },
});

const MainContent = styled('main', {
  flex: 1,
  display: 'flex',
  flexDirection: 'column',
});

const TopBar = styled('header', {
  backgroundColor: 'var(--card-bg)',
  borderBottom: '1px solid var(--border-color)',
  padding: '$4 $8',
  display: 'flex',
  justifyContent: 'space-between',
  alignItems: 'center',
});

const PageTitle = styled('h1', {
  fontSize: '$2xl',
  fontWeight: '$bold',
  color: 'var(--text-primary)',
});

const TopBarActions = styled('div', {
  display: 'flex',
  alignItems: 'center',
  gap: '$4',
});

const NotificationBadge = styled('button', {
  position: 'relative',
  padding: '$2',
  backgroundColor: 'transparent',
  border: 'none',
  cursor: 'pointer',
  color: 'var(--text-primary)',

  '&::after': {
    content: '',
    position: 'absolute',
    top: '4px',
    right: '4px',
    width: '8px',
    height: '8px',
    backgroundColor: '#ef4444',
    borderRadius: '$full',
  },
});

const UserAvatar = styled('div', {
  width: '40px',
  height: '40px',
  borderRadius: '$full',
  backgroundColor: 'var(--bg-secondary)',
  overflow: 'hidden',

  img: {
    width: '100%',
    height: '100%',
    objectFit: 'cover',
  },
});

const ContentArea = styled('div', {
  padding: '$8',
  flex: 1,
});

const StatsGrid = styled('div', {
  display: 'grid',
  gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
  gap: '$6',
  marginBottom: '$8',
});

const StatCard = styled('div', {
  backgroundColor: 'var(--card-bg)',
  borderRadius: '$lg',
  padding: '$6',
  border: '1px solid var(--border-color)',
});

const StatTitle = styled('div', {
  fontSize: '$sm',
  color: 'var(--text-secondary)',
  marginBottom: '$2',
});

const StatValue = styled('div', {
  fontSize: '$3xl',
  fontWeight: '$bold',
  color: 'var(--primary-color)',
  marginBottom: '$2',
});

const StatChange = styled('div', {
  fontSize: '$xs',
  display: 'flex',
  alignItems: 'center',
  gap: '$1',

  variants: {
    trend: {
      up: {
        color: '$green600',
      },
      down: {
        color: '$red600',
      },
      neutral: {
        color: '$gray600',
      },
    },
  },
});

const Section = styled('section', {
  backgroundColor: 'var(--card-bg)',
  borderRadius: '$lg',
  border: '1px solid var(--border-color)',
  overflow: 'hidden',
});

const SectionHeader = styled('div', {
  padding: '$6',
  borderBottom: '1px solid var(--border-color)',
  display: 'flex',
  justifyContent: 'space-between',
  alignItems: 'center',
  gap: '$4',
  flexWrap: 'wrap',
});

const SectionTitle = styled('h2', {
  fontSize: '$lg',
  fontWeight: '$semibold',
  color: 'var(--text-primary)',
});

const SearchBar = styled('div', {
  position: 'relative',
  flex: 1,
  maxWidth: '400px',
});

const SearchInput = styled('input', {
  width: '100%',
  padding: '$2 $3 $2 $10',
  backgroundColor: 'var(--bg-secondary)',
  border: '1px solid var(--border-color)',
  borderRadius: '$base',
  fontSize: '$sm',
  color: 'var(--text-primary)',

  '&::placeholder': {
    color: 'var(--text-secondary)',
  },

  '&:focus': {
    outline: 'none',
    borderColor: 'var(--primary-color)',
  },
});

const SearchIcon = styled(Search, {
  position: 'absolute',
  left: '$3',
  top: '50%',
  transform: 'translateY(-50%)',
  color: 'var(--text-secondary)',
  width: '16px',
  height: '16px',
});

const FilterButton = styled('button', {
  display: 'flex',
  alignItems: 'center',
  gap: '$2',
  padding: '$2 $4',
  backgroundColor: 'var(--bg-secondary)',
  border: '1px solid var(--border-color)',
  borderRadius: '$base',
  fontSize: '$sm',
  color: 'var(--text-primary)',
  cursor: 'pointer',
  whiteSpace: 'nowrap',

  '&:hover': {
    backgroundColor: 'var(--bg-tertiary)',
  },
});

const ExportButton = styled('button', {
  display: 'flex',
  alignItems: 'center',
  gap: '$2',
  padding: '$2 $4',
  backgroundColor: 'var(--card-bg)',
  border: '1px solid var(--border-color)',
  borderRadius: '$base',
  fontSize: '$sm',
  color: 'var(--text-primary)',
  cursor: 'pointer',
  whiteSpace: 'nowrap',

  '&:hover': {
    backgroundColor: 'var(--bg-secondary)',
  },
});

const Table = styled('table', {
  width: '100%',
  borderCollapse: 'collapse',
});

const Th = styled('th', {
  padding: '$4 $6',
  textAlign: 'left',
  fontSize: '$xs',
  fontWeight: '$semibold',
  color: 'var(--text-secondary)',
  textTransform: 'uppercase',
  borderBottom: '1px solid var(--border-color)',
  backgroundColor: 'var(--bg-secondary)',
});

const Td = styled('td', {
  padding: '$4 $6',
  borderBottom: '1px solid var(--border-color)',
  fontSize: '$sm',
  color: 'var(--text-primary)',
});

const UserCell = styled('div', {
  display: 'flex',
  alignItems: 'center',
  gap: '$3',
});

const UserInfo = styled('div', {
  display: 'flex',
  flexDirection: 'column',
});

const UserName = styled('span', {
  fontWeight: '$semibold',
  color: 'var(--text-primary)',
});

const UserEmail = styled('span', {
  fontSize: '$xs',
  color: 'var(--text-secondary)',
});

const StatusBadge = styled('span', {
  padding: '$1 $3',
  borderRadius: '$full',
  fontSize: '$xs',
  fontWeight: '$medium',

  variants: {
    status: {
      active: {
        backgroundColor: '#d1fae5',
        color: '#065f46',
      },
      inactive: {
        backgroundColor: '#fef3c7',
        color: '#92400e',
      },
      banned: {
        backgroundColor: '#fee2e2',
        color: '#991b1b',
      },
    },
  },
});

const ActionButton = styled('button', {
  padding: '$1',
  backgroundColor: 'transparent',
  border: 'none',
  cursor: 'pointer',
  color: 'var(--text-secondary)',

  '&:hover': {
    color: 'var(--primary-color)',
  },
});

const Pagination = styled('div', {
  display: 'flex',
  justifyContent: 'space-between',
  alignItems: 'center',
  padding: '$4 $6',
  borderTop: '1px solid var(--border-color)',
});

const PaginationInfo = styled('span', {
  fontSize: '$sm',
  color: 'var(--text-secondary)',
});

const PaginationButtons = styled('div', {
  display: 'flex',
  gap: '$2',
});

const PageButton = styled('button', {
  padding: '$2 $3',
  backgroundColor: 'var(--card-bg)',
  border: '1px solid var(--border-color)',
  borderRadius: '$base',
  fontSize: '$sm',
  cursor: 'pointer',
  color: 'var(--text-primary)',

  '&:hover': {
    backgroundColor: 'var(--bg-secondary)',
  },

  variants: {
    active: {
      true: {
        backgroundColor: 'var(--primary-color)',
        color: 'white',
        borderColor: 'var(--primary-color)',
      },
    },
  },
});

const ActivitySection = styled('div', {
  marginTop: '$8',
});

const ActivityList = styled('div', {
  padding: '$6',
  display: 'flex',
  flexDirection: 'column',
  gap: '$4',
});

const ActivityItem = styled('div', {
  display: 'flex',
  gap: '$4',
  padding: '$4',
  backgroundColor: 'var(--bg-secondary)',
  borderRadius: '$base',
  border: '1px solid var(--border-color)',
});

const ActivityIcon = styled('div', {
  width: '40px',
  height: '40px',
  borderRadius: '$base',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  flexShrink: 0,

  variants: {
    type: {
      user: {
        backgroundColor: '#dbeafe',
        color: '#1e40af',
      },
      ban: {
        backgroundColor: '#fee2e2',
        color: '#991b1b',
      },
      sale: {
        backgroundColor: '#d1fae5',
        color: '#065f46',
      },
      ai: {
        backgroundColor: '#e0e7ff',
        color: '#4338ca',
      },
    },
  },
});

const ActivityContent = styled('div', {
  flex: 1,
});

const ActivityText = styled('p', {
  fontSize: '$sm',
  color: 'var(--text-primary)',
  marginBottom: '$1',

  strong: {
    fontWeight: '$semibold',
  },
});

const ActivityTime = styled('span', {
  fontSize: '$xs',
  color: 'var(--text-secondary)',
});

const users = [
  {
    id: 1,
    name: 'Alex Johnson',
    email: 'alexj@example.com',
    lastLogin: '2 hours ago',
    joinDate: '2023-01-15',
    status: 'active' as const,
  },
  {
    id: 2,
    name: 'Maria Garcia',
    email: 'maria.g@example.com',
    lastLogin: '1 day ago',
    joinDate: '2023-03-22',
    status: 'active' as const,
  },
  {
    id: 3,
    name: 'Chen Wei',
    email: 'chen.w@example.com',
    lastLogin: '3 days ago',
    joinDate: '2023-05-30',
    status: 'inactive' as const,
  },
  {
    id: 4,
    name: 'Samuel Jones',
    email: 'samj@example.com',
    lastLogin: 'Never',
    joinDate: '2023-10-12',
    status: 'banned' as const,
  },
];

const activities = [
  {
    type: 'user' as const,
    text: '<strong>Nia Adebayo</strong> joined the "Lagos Innovators" guild.',
    time: '2 minutes ago',
  },
  {
    type: 'ban' as const,
    text: '<strong>Admin (You)</strong> banned user <strong>Samuel Jones</strong>. Reason: Spam.',
    time: '15 minutes ago',
  },
  {
    type: 'sale' as const,
    text: '<strong>Alex Johnson</strong> listed a new item: "Handcrafted Beaded Necklace".',
    time: '1 hour ago',
  },
  {
    type: 'ai' as const,
    text: '<strong>Maria Garcia</strong> used AI to generate project ideas for "Eco-Friendly Packaging".',
    time: '3 hours ago',
  },
];

const AdminDashboardPage: React.FC = () => {
  return (
    <AdminAuthGuard>
      <AdminLayout currentPage="users" pageTitle="User Management">
          <StatsGrid>
            <StatCard>
              <StatTitle>Total Users</StatTitle>
              <StatValue>12,500</StatValue>
              <StatChange trend="up">
                ↑ +1.2% this month
              </StatChange>
            </StatCard>
            <StatCard>
              <StatTitle>Active Users (24h)</StatTitle>
              <StatValue>3,450</StatValue>
              <StatChange trend="down">
                ↓ -0.8% vs yesterday
              </StatChange>
            </StatCard>
            <StatCard>
              <StatTitle>New Signups</StatTitle>
              <StatValue>182</StatValue>
              <StatChange trend="up">
                ↑ +5.1% this week
              </StatChange>
            </StatCard>
            <StatCard>
              <StatTitle>Banned Accounts</StatTitle>
              <StatValue>42</StatValue>
              <StatChange trend="neutral">
                ⚠️ Manual action required
              </StatChange>
            </StatCard>
          </StatsGrid>

          <Section>
            <SectionHeader>
              <SearchBar>
                <SearchIcon />
                <SearchInput placeholder="Search by name, email..." />
              </SearchBar>
              <FilterButton>
                Filter by Status
                <ChevronDown size={16} />
              </FilterButton>
              <ExportButton>
                <Download size={16} />
                Export User Data
              </ExportButton>
            </SectionHeader>

            <Table>
              <thead>
                <tr>
                  <Th>USER</Th>
                  <Th>LAST LOGIN</Th>
                  <Th>JOIN DATE</Th>
                  <Th>STATUS</Th>
                  <Th>ACTIONS</Th>
                </tr>
              </thead>
              <tbody>
                {users.map((user) => (
                  <tr key={user.id}>
                    <Td>
                      <UserCell>
                        <UserAvatar>
                          <img
                            src={`https://i.pravatar.cc/150?img=${user.id}`}
                            alt={user.name}
                          />
                        </UserAvatar>
                        <UserInfo>
                          <UserName>{user.name}</UserName>
                          <UserEmail>{user.email}</UserEmail>
                        </UserInfo>
                      </UserCell>
                    </Td>
                    <Td>{user.lastLogin}</Td>
                    <Td>{user.joinDate}</Td>
                    <Td>
                      <StatusBadge status={user.status}>
                        {user.status.charAt(0).toUpperCase() + user.status.slice(1)}
                      </StatusBadge>
                    </Td>
                    <Td>
                      <ActionButton>
                        {user.status === 'banned' ? (
                          <Unlock size={18} />
                        ) : (
                          <Ban size={18} />
                        )}
                      </ActionButton>
                    </Td>
                  </tr>
                ))}
              </tbody>
            </Table>

            <Pagination>
              <PaginationInfo>Showing 1 to 4 of 12,500 users</PaginationInfo>
              <PaginationButtons>
                <PageButton>Prev</PageButton>
                <PageButton active>1</PageButton>
                <PageButton>2</PageButton>
                <PageButton>Next</PageButton>
              </PaginationButtons>
            </Pagination>
          </Section>

          <ActivitySection>
            <Section>
              <SectionHeader>
                <SectionTitle>User Activity Log</SectionTitle>
                <div style={{ display: 'flex', gap: '1rem' }}>
                  <SearchBar style={{ maxWidth: '300px' }}>
                    <SearchIcon />
                    <SearchInput placeholder="Search logs..." />
                  </SearchBar>
                  <FilterButton>
                    Filter by Action
                    <ChevronDown size={16} />
                  </FilterButton>
                  <FilterButton>
                    <Calendar size={16} />
                    Select date range
                  </FilterButton>
                </div>
              </SectionHeader>

              <ActivityList>
                {activities.map((activity, index) => (
                  <ActivityItem key={index}>
                    <ActivityIcon type={activity.type}>
                      {activity.type === 'user' && <UsersIcon size={20} />}
                      {activity.type === 'ban' && <Ban size={20} />}
                      {activity.type === 'sale' && <Receipt size={20} />}
                      {activity.type === 'ai' && <TrendingUp size={20} />}
                    </ActivityIcon>
                    <ActivityContent>
                      <ActivityText dangerouslySetInnerHTML={{ __html: activity.text }} />
                      <ActivityTime>{activity.time}</ActivityTime>
                    </ActivityContent>
                  </ActivityItem>
                ))}
              </ActivityList>
            </Section>
          </ActivitySection>
      </AdminLayout>
    </AdminAuthGuard>
  );
};

export default AdminDashboardPage;
